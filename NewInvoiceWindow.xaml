<Window x:Class="EmployeeManagerWPF.NewInvoiceWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Create New Invoice"
        Height="850"
        Width="900"
        WindowStartupLocation="CenterScreen"
        Background="#f8f9fa">

    <Window.Resources>
        <!-- Modern Card Style -->
        <Style x:Key="Card" TargetType="Border">
            <Setter Property="Background" Value="White"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="20"/>
            <Setter Property="Margin" Value="0,0,0,16"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="#000000" Opacity="0.05" BlurRadius="10" ShadowDepth="2"/>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Section Header -->
        <Style x:Key="SectionHeader" TargetType="TextBlock">
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="#1f2937"/>
            <Setter Property="Margin" Value="0,0,0,16"/>
        </Style>

        <!-- Label Style -->
        <Style x:Key="Label" TargetType="TextBlock">
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Foreground" Value="#4b5563"/>
            <Setter Property="Margin" Value="0,0,0,6"/>
        </Style>

        <!-- Input Style -->
        <Style x:Key="Input" TargetType="TextBox">
            <Setter Property="Height" Value="36"/>
            <Setter Property="Padding" Value="10,8"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="BorderBrush" Value="#d1d5db"/>
            <Setter Property="BorderThickness" Value="1"/>
        </Style>

        <!-- ComboBox Style -->
        <Style x:Key="Dropdown" TargetType="ComboBox">
            <Setter Property="Height" Value="36"/>
            <Setter Property="Padding" Value="10,8"/>
            <Setter Property="FontSize" Value="13"/>
        </Style>

        <!-- Button Style -->
        <Style x:Key="PrimaryButton" TargetType="Button">
            <Setter Property="Height" Value="40"/>
            <Setter Property="Padding" Value="24,0"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Background" Value="#2563eb"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                CornerRadius="6"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#1d4ed8"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="SecondaryButton" TargetType="Button">
            <Setter Property="Height" Value="32"/>
            <Setter Property="Padding" Value="16,0"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Background" Value="#f3f4f6"/>
            <Setter Property="Foreground" Value="#374151"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                CornerRadius="6"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#e5e7eb"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Grid>
        <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="24">
            <StackPanel MaxWidth="850">

                <!-- Page Title -->
                <TextBlock Text="Create New Invoice" 
                           FontSize="24" 
                           FontWeight="Bold" 
                           Foreground="#111827"
                           Margin="0,0,0,24"/>

                <!-- Step 1: Select Service -->
                <Border Style="{StaticResource Card}">
                    <StackPanel>
                        <TextBlock Text="1. Select Service" Style="{StaticResource SectionHeader}"/>

                        <TextBlock Text="Service Type *" Style="{StaticResource Label}"/>
                        <ComboBox x:Name="ServiceTypeComboBox" 
                                  Style="{StaticResource Dropdown}"
                                  SelectionChanged="ServiceTypeComboBox_SelectionChanged">
                            <ComboBoxItem Content="Aarvi Water Supplier"/>
                            <ComboBoxItem Content="Aarvi Car Washing"/>
                            <ComboBoxItem Content="Aarvi Laundry Service"/>
                        </ComboBox>
                    </StackPanel>
                </Border>

                <!-- Step 2: Select Society (Only for Car Washing) -->
                <Border x:Name="SocietySection" Style="{StaticResource Card}" Visibility="Collapsed">
                    <StackPanel>
                        <TextBlock Text="2. Select Society" Style="{StaticResource SectionHeader}"/>

                        <TextBlock Text="Society *" Style="{StaticResource Label}"/>
                        <ComboBox x:Name="SocietyComboBox" 
                                  Style="{StaticResource Dropdown}"
                                  SelectionChanged="SocietyComboBox_SelectionChanged"/>
                    </StackPanel>
                </Border>

                <!-- Step 3: Select Customer -->
                <Border x:Name="CustomerSection" Style="{StaticResource Card}" Visibility="Collapsed">
                    <StackPanel>
                        <TextBlock x:Name="CustomerSectionTitle" Text="2. Select Customer" Style="{StaticResource SectionHeader}"/>

                        <TextBlock Text="Customer Name *" Style="{StaticResource Label}"/>
                        <ComboBox x:Name="CustomerComboBox" 
                                  Style="{StaticResource Dropdown}"
                                  SelectionChanged="CustomerComboBox_SelectionChanged"/>

                        <Grid Margin="0,16,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="16"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Phone" Style="{StaticResource Label}"/>
                                <TextBox x:Name="CustomerPhoneBox" Style="{StaticResource Input}" IsReadOnly="True"/>
                            </StackPanel>

                            <StackPanel Grid.Column="2">
                                <TextBlock Text="Email" Style="{StaticResource Label}"/>
                                <TextBox x:Name="CustomerEmailBox" Style="{StaticResource Input}" IsReadOnly="True"/>
                            </StackPanel>
                        </Grid>

                        <TextBlock Text="Address" Style="{StaticResource Label}" Margin="0,16,0,6"/>
                        <TextBox x:Name="CustomerAddressBox" 
                                 Height="70" 
                                 Padding="10" 
                                 FontSize="13"
                                 BorderBrush="#d1d5db"
                                 BorderThickness="1"
                                 TextWrapping="Wrap" 
                                 AcceptsReturn="True"
                                 IsReadOnly="True"/>
                    </StackPanel>
                </Border>

                <!-- Step 4: Invoice Details -->
                <Border x:Name="InvoiceDetailsSection" Style="{StaticResource Card}" Visibility="Collapsed">
                    <StackPanel>
                        <TextBlock x:Name="InvoiceDetailsSectionTitle" Text="3. Invoice Details" Style="{StaticResource SectionHeader}"/>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="16"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Invoice Date *" Style="{StaticResource Label}"/>
                                <DatePicker x:Name="InvoiceDatePicker" Height="36" FontSize="13"/>
                            </StackPanel>

                            <StackPanel Grid.Column="2">
                                <TextBlock Text="Status *" Style="{StaticResource Label}"/>
                                <ComboBox x:Name="StatusComboBox" Style="{StaticResource Dropdown}">
                                    <ComboBoxItem Content="Unpaid" IsSelected="True"/>
                                    <ComboBoxItem Content="Paid"/>
                                    <ComboBoxItem Content="Pending"/>
                                </ComboBox>
                            </StackPanel>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- Step 5: Service-Specific Details (Water/Car) -->
                <Border x:Name="ServiceSpecificSection" Style="{StaticResource Card}" Visibility="Collapsed">
                    <StackPanel x:Name="ServiceSpecificPanel">
                        <!-- Dynamic content based on service type -->
                    </StackPanel>
                </Border>

                <!-- Step 6: Line Items -->
                <Border x:Name="ItemsSection" Style="{StaticResource Card}" Visibility="Collapsed">
                    <StackPanel>
                        <TextBlock x:Name="ItemsSectionTitle" Text="5. Invoice Items" Style="{StaticResource SectionHeader}"/>

                        <DataGrid x:Name="ItemsGrid"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  SelectionMode="Single"
                                  Height="200"
                                  Margin="0,0,0,12"
                                  BorderBrush="#d1d5db"
                                  BorderThickness="1"
                                  SelectionChanged="ItemsGrid_SelectionChanged">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Item Name" Binding="{Binding ItemName}" Width="2*"/>
                                <DataGridTextColumn Header="Description" Binding="{Binding Description}" Width="2*"/>
                                <DataGridTextColumn Header="Rate" Binding="{Binding Rate, StringFormat='{}{0:N2}'}" Width="*"/>
                                <DataGridTextColumn Header="Qty" Binding="{Binding Quantity}" Width="80"/>
                                <DataGridTextColumn Header="Amount" IsReadOnly="True" Binding="{Binding Amount, StringFormat='{}{0:N2}'}" Width="*"/>
                            </DataGrid.Columns>
                        </DataGrid>

                        <StackPanel Orientation="Horizontal">
                            <Button Content="Remove Selected" 
                                    Style="{StaticResource SecondaryButton}"
                                    Click="RemoveItem_Click"/>
                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- Step 7: Totals & Notes -->
                <Border x:Name="TotalsSection" Style="{StaticResource Card}" Visibility="Collapsed">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="300"/>
                        </Grid.ColumnDefinitions>

                        <!-- Notes -->
                        <StackPanel Grid.Column="0" Margin="0,0,20,0">
                            <TextBlock Text="Notes" Style="{StaticResource SectionHeader}"/>
                            <TextBox x:Name="NotesBox" 
                                     Height="120" 
                                     Padding="10"
                                     FontSize="13"
                                     BorderBrush="#d1d5db"
                                     BorderThickness="1"
                                     TextWrapping="Wrap" 
                                     AcceptsReturn="True"
                                     VerticalScrollBarVisibility="Auto"/>
                        </StackPanel>

                        <!-- Totals -->
                        <StackPanel Grid.Column="1">
                            <TextBlock Text="Summary" Style="{StaticResource SectionHeader}"/>

                            <Border Background="#f9fafb" 
                                    Padding="16" 
                                    CornerRadius="6"
                                    BorderBrush="#e5e7eb"
                                    BorderThickness="1">
                                <StackPanel>
                                    <!-- Subtotal -->
                                    <Grid Margin="0,0,0,8">
                                        <TextBlock Text="Subtotal" FontSize="13" Foreground="#6b7280"/>
                                        <TextBlock x:Name="SubtotalText" 
                                                   Text="₹0.00" 
                                                   FontSize="13" 
                                                   HorizontalAlignment="Right"/>
                                    </Grid>

                                    <!-- Discount -->
                                    <Grid Margin="0,0,0,8">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="Discount" FontSize="13" Foreground="#6b7280"/>
                                            <TextBox x:Name="DiscountPercentBox" 
                                                     Width="50" 
                                                     Height="24"
                                                     Margin="8,0"
                                                     Text="0"
                                                     TextAlignment="Center"
                                                     FontSize="12"/>
                                            <TextBlock Text="%" FontSize="13" Foreground="#6b7280"/>
                                        </StackPanel>
                                        <TextBlock x:Name="DiscountAmountText" 
                                                   Text="-₹0.00" 
                                                   FontSize="13" 
                                                   HorizontalAlignment="Right"
                                                   Foreground="#dc2626"/>
                                    </Grid>

                                    <!-- Separator -->
                                    <Border Height="1" Background="#e5e7eb" Margin="0,8"/>

                                    <!-- Total -->
                                    <Grid Margin="0,8,0,0">
                                        <TextBlock Text="Total" 
                                                   FontSize="16" 
                                                   FontWeight="Bold"
                                                   Foreground="#111827"/>
                                        <TextBlock x:Name="TotalText" 
                                                   Text="₹0.00" 
                                                   FontSize="16" 
                                                   FontWeight="Bold"
                                                   Foreground="#111827"
                                                   HorizontalAlignment="Right"/>
                                    </Grid>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Submit Button -->
                <Border x:Name="SubmitSection" Visibility="Collapsed" Margin="0,8,0,0">
                    <Button Content="Create Invoice" 
                            Style="{StaticResource PrimaryButton}"
                            HorizontalAlignment="Right"
                            Click="SubmitInvoice_Click"
                            Width="200"/>
                </Border>

            </StackPanel>
        </ScrollViewer>
    </Grid>
</Window>